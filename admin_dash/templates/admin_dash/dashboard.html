{% extends "admin_dash/base.html" %} 
{% block title %}Questions{% endblock %} 
{% block extra_css %}
<style>
  .form-group {
    display: flex;
    justify-content: space-between;
  } 
  .ques-submit {
    margin-left: 2rem;
    width: 20%;
  }
  .selected-row {
    background-color: #444444 !important; /* Change the color as needed */
  }
  .action-drop {
    display: flex;
    justify-content: flex-start;
    margin-bottom: 1rem;
  }
  .action-drop .action-text {
    padding-top: 0.5rem;
    width: 10%;
    color: white;
    align-items: center;
    font-weight: 700;
  }
  .action-drop select {
    background-color: #0D1015;
    color: white;
    border: 1px solid #444444;
    padding: 0.5rem;
    border-radius: 4px;
    width: 100%;
  }
  .action-drop .action-submit {
    padding-left: 1rem;
  }
  .btn-action {
    border: 1px solid #444444;
    border-radius: 4px;
    width: 105%;
    height: 104%;
  }
  .btn-action:hover {
    border: 1px solid #444444;
    border-radius: 4px;
    background-color: #1c2028;
    font-weight: 600;
  }
  .btn-action:focus {
    border: 1px solid #444444;
    border-radius: 4px;
  }
</style>
{% endblock %}
{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const selectAllCheckbox = document.getElementById('select-all');
    const rowCheckboxes = document.querySelectorAll('tbody input[type="checkbox"]');
    const actionForm = document.getElementById('action-form');
    const actionSelect = document.getElementById('action');
    const selectedQuestionIdsInput = document.getElementById('selected-questions');

    // Toggle class for individual row checkboxes
    rowCheckboxes.forEach(function (checkbox) {
      checkbox.addEventListener('change', function () {
        const row = checkbox.closest('tr');
        if (checkbox.checked) {
          row.classList.add('selected-row');
        } else {
          row.classList.remove('selected-row');
        }
      });
    });

    // Add an event listener to the header checkbox
    selectAllCheckbox.addEventListener('change', function () {
      rowCheckboxes.forEach(function (checkbox) {
        checkbox.checked = selectAllCheckbox.checked;
        const row = checkbox.closest('tr');
        if (selectAllCheckbox.checked) {
          row.classList.add('selected-row');
        } else {
          row.classList.remove('selected-row');
        }
      });
    });

    actionForm.addEventListener('submit', function (event) {
      const selectedIds = [];
      rowCheckboxes.forEach(function (checkbox) {
        if (checkbox.checked) {
          const row = checkbox.closest('tr');
          const questionId = row.querySelector('td:nth-child(2)').textContent.trim(); // Assumes ID is in the second column
          selectedIds.push(questionId);
        }
      });

      if (actionSelect.value === "Delete Selected Questions") {
        selectedQuestionIdsInput.value = selectedIds.join(',');
      } else {
        // If not deleting, clear the hidden input field
        selectedQuestionIdsInput.value = '';
      }
    });
  });
</script>
{% endblock %}

{% block content %}
<div class="c-app flex-row align-items-start parent">
  <div class="container">
    <div class="row">
    </div>
    <div class="row justify-content-center">
      <div class="col-md-10">
        <div class="text" style="color: white; font-size: 2rem; margin-top: 2rem;">
          <div class="mb-4 font-mono text-xl">Add questions with IDs</div>
        </div>
        <div class="card-body">
          <!-- Form for adding questions -->
          <form method="POST" action="{% url 'admin_dash:add_ques_from_id' %}">
            {% csrf_token %}
            <div class="form-group">
              <input type="text" class="form-control" id="question_ids" name="question_ids" placeholder="Enter question IDs separated by commas" required>
              <button type="submit" class="btn btn-primary ques-submit">Add Questions</button>
            </div>
          </form>
        </div>
        <div class="text" style="color: white; font-size: 2rem; margin-top: 2rem;">
          <div class="mb-2 font-mono text-xl">Select a question to change</div>
        </div>
        <form id="action-form" method="POST" action="{% url 'admin_dash:delete_ques_with_ids' %}">
          {% csrf_token %}
          <div class="action-drop">
            <div class="text action-text">Action: </div>
            <div class="acton-dropdown">
              <select name="Action" id="action">
                <option value="Nothing">Nothing</option>
                <option value="Delete Selected Questions">Delete Selected Questions</option>
              </select>
            </div>
            <div class="action-submit">
              <button type="submit" class="btn btn-action" style="color: white;">Go</button>
            </div>
          </div>
          <input type="hidden" name="selected_questions" id="selected-questions">
        </form>
        <div class="card-body">
          <!-- Table displaying model entries -->
          <table class="table table-dark table-striped">
            <thead>
              <tr>
                <th><input type="checkbox" id="select-all"></th>
                <th style="text-wrap: nowrap;">LeetCode ID</th>
                <th>Title</th>
                <th>Title Slug</th>
                <th>Date</th>
                <th>Difficulty</th>
              </tr>
            </thead>
            <tbody>
              {% for question in questions %}
              <tr>
                <td><input type="checkbox"></td>
                <td>{{ question.leetcode_id }}</td>
                <td>
                  <a href="{% url 'admin_dash:edit_question' question.pk %}">
                    {{ question.title }}
                  </a>
                </td>
                <td>{{ question.titleSlug }}</td>
                <td>{{ question.questionDate }}</td>
                <td>{{ question.difficulty }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
